import streamlit as st
import pandas as pd

# Ρύθμιση σελίδας
st.set_page_config(page_title="Ethics Quest", layout="centered")

# Τίτλος Εφαρμογής και Στοιχεία Φοιτητή
st.markdown("<h1 style='text-align: center;'>🎮 Ethics Quest</h1>", unsafe_allow_html=True)
st.markdown(
    """
    <div style='background-color: #f0f2f6; padding: 10px; border-radius: 10px; border: 1px solid #d1d5db; text-align: center;'>
        <p style='margin: 0; font-weight: bold; color: #1f2937;'>ΚΩΝΣΤΑΝΤΙΝΟΣ ΜΠΡΟΥΚΑ</p>
        <p style='margin: 0; color: #4b5563;'>ΑΜ: inf2023139</p>
    </div>
    """, 
    unsafe_allow_html=True
)
st.markdown("---")

# Αρχικοποίηση scores στο session_state
if 'step' not in st.session_state:
    st.session_state.step = 0
    st.session_state.scores = {
        "Ιδιωτικότητα": 50,
        "Ασφάλεια": 50,
        "Κέρδος/Αποδοτικότητα": 50,
        "Κοινωνική Δικαιοσύνη": 50
    }

# Λίστα Σεναρίων με το τελικό κείμενο
scenarios = [
    {
        "title": "Σενάριο 1: Έξυπνες Πόλεις & Βιομετρική Επιτήρηση",
        "text": """**Πλαίσιο:** Η δημοτική αρχή προτείνει την εγκατάσταση καμερών με αναγνώριση προσώπου για την πρόληψη του εγκλήματος σε πραγματικό χρόνο.
        
**Το Ηθικό Δίλημμα:** Η τεχνολογία αυτή μπορεί να εντοπίσει καταζητούμενους, αλλά ταυτόχρονα καταργεί την ανωνυμία των πολιτών στον δημόσιο χώρο, δημιουργώντας μια κοινωνία διαρκούς παρακολούθησης.""",
        "options": [
            {"text": "✅ Πλήρης Εφαρμογή: Η δημόσια ασφάλεια προέχει. Αν κάποιος δεν παρανομεί, η καταγραφή δεν αποτελεί απειλή γι' αυτόν.", "impact": {"Ασφάλεια": 30, "Ιδιωτικότητα": -40, "Κέρδος/Αποδοτικότητα": 20}},
            {"text": "⚠️ Περιορισμένη Χρήση: Εγκατάσταση μόνο σε σημεία υψηλού κινδύνου, προσπαθώντας να εξισορροπηθεί η προστασία με τα ατομικά δικαιώματα.", "impact": {"Ασφάλεια": 10, "Ιδιωτικότητα": -10, "Κοινωνική Δικαιοσύνη": -10}},
            {"text": "❌ Απόρριψη Έργου: Η μαζική επιτήρηση υπονομεύει τις δημοκρατικές ελευθερίες και το δικαίωμα στην ιδιωτική ζωή.", "impact": {"Ασφάλεια": -20, "Ιδιωτικότητα": 40, "Κοινωνική Δικαιοσύνη": 20}}
        ]
    },
    {
        "title": "Σενάριο 2: Αλγοριθμική Προκατάληψη στην Αστυνόμευση",
        "text": """**Πλαίσιο:** Χρησιμοποιείς έναν αλγόριθμο που προβλέπει περιοχές υψηλής εγκληματικότητας. Το σύστημα όμως στοχοποιεί συνεχώς υποβαθμισμένες γειτονιές, ανακυκλώνοντας παλιές κοινωνικές προκαταλήψεις.
        
**Το Ηθικό Δίλημμα:** Η διατήρηση του αλγορίθμου ενισχύει τις διακρίσεις, ενώ η χειροκίνητη παρέμβαση στον κώδικα για λόγους δικαιοσύνης ενδέχεται να μειώσει τη στατιστική ακρίβεια των προβλέψεων.""",
        "options": [
            {"text": "✅ Διατήρηση Ακρίβειας: Ο αλγόριθμος πρέπει να παραμείνει αντικειμενικός βάσει των δεδομένων, χωρίς ανθρώπινη παρέμβαση στα αποτελέσματα.", "impact": {"Κέρδος/Αποδοτικότητα": 30, "Κοινωνική Δικαιοσύνη": -40}},
            {"text": "🛠️ Ηθική Διόρθωση: Τροποποίηση του συστήματος ώστε να κατανέμει δίκαια τις περιπολίες, δίνοντας προτεραιότητα στην κοινωνική ισότητα.", "impact": {"Κοινωνική Δικαιοσύνη": 30, "Κέρδος/Αποδοτικότητα": -10}},
            {"text": "📢 Διαφάνεια & Έλεγχος: Δημοσιοποίηση της λειτουργίας του αλγορίθμου, ώστε η κοινωνία να αποφασίσει για τα όρια της χρήσης του.", "impact": {"Κοινωνική Δικαιοσύνη": 40, "Κέρδος/Αποδοτικότητα": -30, "Ασφάλεια": -10}}
        ]
    },
    {
        "title": "Σενάριο 3: Σχεδιασμός για Εθισμό (Dark Patterns)",
        "text": """**Πλαίσιο:** Σου ζητείται να ενσωματώσεις στα Social Media λειτουργίες που εκμεταλλεύονται την ψυχολογία του χρήστη (π.χ. άπειρο σκρολάρισμα) για να αυξηθεί ο χρόνος παραμονής στην εφαρμογή.
        
**Το Ηθικό Δίλημμα:** Αυτές οι πρακτικές αυξάνουν τα έσοδα της εταιρείας, αλλά συνδέονται με προβλήματα ψυχικής υγείας και εθισμό, ειδικά στους νεότερους χρήστες.""",
        "options": [
            {"text": "💰 Προτεραιότητα στο Κέρδος: Η ευθύνη χρήσης ανήκει στον χρήστη. Στόχος της εφαρμογής είναι η μέγιστη αποδοτικότητα και η βιωσιμότητα.", "impact": {"Κέρδος/Αποδοτικότητα": 40, "Κοινωνική Δικαιοσύνη": -30}},
            {"text": "🛡️ Μέτρα Προστασίας: Εφαρμογή των λειτουργιών, αλλά με ταυτόχρονη εισαγωγή ειδοποιήσεων για τον χρόνο χρήσης (digital wellbeing).", "impact": {"Κοινωνική Δικαιοσύνη": 10, "Κέρδος/Αποδοτικότητα": 10}},
            {"text": "🌿 Ηθικός Σχεδιασμός: Άρνηση χρήσης χειραγωγικών μοτίβων. Σχεδιασμός που σέβεται την αυτονομία και την ψυχική ηρεμία του ατόμου.", "impact": {"Ιδιωτικότητα": 30, "Κέρδος/Αποδοτικότητα": -30}}
        ]
    },
    {
        "title": "Σενάριο 4: Διαχείριση και Πώληση Ιατρικών Δεδομένων",
        "text": """**Πλαίσιο:** Μια ασφαλιστική εταιρεία ζητά πρόσβαση σε 'ανωνυμοποιημένα' δεδομένα ασθενών για ερευνητικούς σκοπούς, προσφέροντας μεγάλη χρηματοδότηση στο νοσοκομείο.
        
**Το Ηθικό Δίλημμα:** Υπάρχει ο τεχνικός κίνδυνος ταυτοποίησης των ασθενών (de-anonymization). Η διαρροή τέτοιων πληροφοριών μπορεί να οδηγήσει σε διακρίσεις κατά των ασθενών από ασφαλιστικούς φορείς.""",
        "options": [
            {"text": "🤝 Αποδοχή Συμφωνίας: Η χρηματοδότηση είναι απαραίτητη για τη βελτίωση των υποδομών υγείας. Το νομικό πλαίσιο ανωνυμοποίησης μας καλύπτει.", "impact": {"Κέρδος/Αποδοτικότητα": 40, "Ιδιωτικότητα": -40}},
            {"text": "🔐 Τεχνική Διασφάλιση: Χρήση προηγμένων μεθόδων κρυπτογράφησης (Differential Privacy) που προστατεύουν τους ασθενείς, έστω και με κόστος στην ακρίβεια.", "impact": {"Ιδιωτικότητα": 20, "Κέρδος/Αποδοτικότητα": 10}},
            {"text": "🚫 Απόρριψη Συναλλαγής: Τα προσωπικά δεδομένα υγείας δεν πρέπει να γίνονται αντικείμενο εμπορικής εκμετάλλευσης χωρίς ρητή συγκατάθεση.", "impact": {"Ιδιωτικότητα": 40, "Κέρδος/Αποδοτικότητα": -30}}
        ]
    },
    {
        "title": "Σενάριο 5: Κυβερνοασφάλεια και Κρίσιμες Υποδομές",
        "text": """**Πλαίσιο:** Μια επίθεση Ransomware έχει κλειδώσει το σύστημα ηλεκτροδότησης της πόλης. Οι επιτιθέμενοι απαιτούν λύτρα για να ξεκλειδώσουν το δίκτυο.
        
**Το Ηθικό Δίλημμα:** Η πληρωμή λύτρων χρηματοδοτεί το έγκλημα, ενώ η άρνηση θέτει σε άμεσο κίνδυνο τη λειτουργία νοσοκομείων και την ασφάλεια των πολιτών για ημέρες.""",
        "options": [
            {"text": "🆘 Καταβολή Λύτρων: Η προστασία της ανθρώπινης ζωής είναι υπεράνω κάθε ηθικής αρχής. Απαιτείται η άμεση αποκατάσταση του ρεύματος.", "impact": {"Ασφάλεια": 30, "Κοινωνική Δικαιοσύνη": -20, "Κέρδος/Αποδοτικότητα": -10}},
            {"text": "🛡️ Άρνηση Συμβιβασμού: Καμία διαπραγμάτευση με εγκληματίες. Επιλογή της δύσκολης οδού της ανάκτησης συστημάτων, παρά το κοινωνικό κόστος.", "impact": {"Ασφάλεια": -20, "Κοινωνική Δικαιοσύνη": 20}},
            {"text": "⚔️ Επιθετική Αντεπίθεση: Προσπάθεια 'αντι-χακαρίσματος' για ανάκτηση του ελέγχου, ρισκάροντας όμως τη μόνιμη καταστροφή των δεδομένων.", "impact": {"Ασφάλεια": 10, "Κέρδος/Αποδοτικότητα": -20}}
        ]
    },
    {
        "title": "Σενάριο 6: AI Detectors στην Ακαδημαϊκή Εκπαίδευση",
        "text": """**Πλαίσιο:** Το Πανεπιστήμιο χρησιμοποιεί αλγόριθμο για την ανίχνευση εργασιών που γράφτηκαν από AI. Το σύστημα όμως εμφανίζει συχνά 'ψευδώς θετικά' αποτελέσματα για φοιτητές που γράφουν σε μη μητρική γλώσσα.
        
**Το Ηθικό Δίλημμα:** Η χρήση του εργαλείου προστατεύει το κύρος του πτυχίου από την αντιγραφή, αλλά κινδυνεύει να στοχοποιήσει άδικα φοιτητές χωρίς αδιαμφισβήτητες αποδείξεις.""",
        "options": [
            {"text": "🎓 Αυστηρή Επιβολή: Η καταπολέμηση της λογοκλοπής είναι απαραίτητη για την ακαδημαϊκή ακεραιότητα, παρά τις ατέλειες του συστήματος.", "impact": {"Κοινωνική Δικαιοσύνη": -40, "Κέρδος/Αποδοτικότητα": 30}},
            {"text": "🔍 Συμβουλευτικός Ρόλος: Το εργαλείο παρέχει μόνο ενδείξεις. Η τελική κρίση απαιτεί προσωπική εξέταση του φοιτητή από τον καθηγητή.", "impact": {"Κοινωνική Δικαιοσύνη": 10, "Κέρδος/Αποδοτικότητα": -10}},
            {"text": "🛑 Απόρριψη Εργαλείου: Ένα ανακριβές σύστημα που εισάγει διακρίσεις δεν μπορεί να αποτελεί κριτήριο αξιολόγησης στην εκπαίδευση.", "impact": {"Κοινωνική Δικαιοσύνη": 40, "Κέρδος/Αποδοτικότητα": -20}}
        ]
    }
]

# UI Παιχνιδιού
st.title("⚖️ Ηθική της Πληροφορικής: Το Παιχνίδι των Αποφάσεων")
st.markdown("---")

if st.session_state.step < len(scenarios):
    current = scenarios[st.session_state.step]
    st.subheader(current["title"])
    st.info(current["text"])
    
    st.write("**Ποια είναι η απόφασή σας;**")
    for idx, option in enumerate(current["options"]):
        if st.button(option["text"], key=f"btn_{st.session_state.step}_{idx}"):
            for key, val in option["impact"].items():
                st.session_state.scores[key] += val
            st.session_state.step += 1
            st.rerun()

else:
    st.balloons()
    st.header("📊 Το Ηθικό σου Προφίλ")
    
    # Λογική Τίτλων
    final_scores = st.session_state.scores
    if (final_scores["Ιδιωτικότητα"] + final_scores["Κοινωνική Δικαιοσύνη"]) > (final_scores["Ασφάλεια"] + final_scores["Κέρδος/Αποδοτικότητα"] + 20):
        user_title = "Ο Ηθικός Ιδεαλιστής"
        user_desc = "Βάζεις τις αξίες και τα ανθρώπινα δικαιώματα πάνω από το κέρδος και την τεχνολογία."
    elif (final_scores["Ασφάλεια"] + final_scores["Κέρδος/Αποδοτικότητα"]) > (final_scores["Ιδιωτικότητα"] + final_scores["Κοινωνική Δικαιοσύνη"] + 20):
        user_title = "Ο Πραγματιστής Τεχνοκράτης"
        user_desc = "Εστιάζεις στη λύση των προβλημάτων και στην αποτελεσματικότητα των συστημάτων."
    else:
        user_title = "Ο Συνετός Διπλωμάτης"
        user_desc = "Προσπαθείς να βρεις τη 'χρυσή τομή' ανάμεσα στα δικαιώματα και τις ανάγκες της αγοράς."

    st.subheader(f"Τίτλος: {user_title}")
    st.write(f"*{user_desc}*")
    st.markdown("---")
    
    # Εμφάνιση Progress Bars
    for metric, value in st.session_state.scores.items():
        display_val = max(0, min(100, value))
        st.write(f"**{metric}**")
        st.progress(display_val / 100)
        
    if st.button("Επανεκκίνηση Παιχνιδιού"):
        st.session_state.step = 0
        st.session_state.scores = {"Ιδιωτικότητα": 50, "Ασφάλεια": 50, "Κέρδος/Αποδοτικότητα": 50, "Κοινωνική Δικαιοσύνη": 50}
        st.rerun()

st.sidebar.markdown("### Στοιχεία Εργασίας")
st.sidebar.write("**Μάθημα:** Ηθική της Πληροφορικής")
st.sidebar.info("Διαδραστική παρουσίαση ηθικών διλημμάτων στην τεχνολογία.")
